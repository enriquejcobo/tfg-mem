%---------------------------------------------------------------------
%
%                          Capítulo 7
%
%---------------------------------------------------------------------

\chapter{Software}
\label{cap:software}

\begin{FraseCelebre}
\begin{Frase}
La gente crítica con el software \\
debería hacer su propio hardware.
\end{Frase}
\begin{Fuente}
Alan Kay
\end{Fuente}
\end{FraseCelebre}

\begin{resumen}
This chapter gives a vision about the main changes required for the firmware to be adapted to the platform, the new software implementations and the behavior of the final demo application.
\end{resumen}

%-------------------------------------------------------------------
\section{Interfaz Hardware-Software}
%-------------------------------------------------------------------
\label{software:sec:interfaz}
%-------------------------------------------------------------------

La interfaz \textit{hardware}-\textit{software} no es más que una capa, dentro del sistema, que se encarga de abstraer los recursos \textit{hardware} por medio de funciones que pueden ser invocadas y que rigen su funcionamiento. Es por ello que esta interfaz también se la conoce por el nombre de \ac{HAL}.

El lenguaje usado para la realización de la misma será C, puesto que se dispone de una amplia librería de funciones ya desarrolladas por el fabricante para el microcontrolador en este lenguaje, y puesto que fue el \textit{software} usado para escribir el \ac{CNGD}. El manual de referencia usado ha sido \cite{thec}. 

Nuestro código será implementado básicamente en dos ficheros: \verb@SensorsHAL.c@, que será el fichero maestro en el que se encuentren detalladas las acciones llevadas a cabo por las funciones, y \verb@SensorsHAL.h@, en el cual se encuentran las cabeceras exportadas de las funciones, de forma que las mismas puedan ser accedidas desde otro punto del programa en el que se incluya este fichero.

Todo el código desarrollado se encuentra accesible públicamente en Internet siguiendo el siguiente enlace o consultando el código QR de la figura \ref{software:fig:qrgithub}: \url{http://github.com/enriquejcobo/tfg-soft}

\figuraEx{Bitmap/Capitulo7/qrgithub}{width=.3\textwidth}{software:fig:qrgithub}%
{Repositorio público del \textit{software}.\\\url{http://github.com/enriquejcobo/tfg-soft}}{Repositorio público del \textit{software}.}

%-------------------------------------------------------------------
\subsection{Funciones generales y adaptación}
%-------------------------------------------------------------------
\label{software:sec:general}
%-------------------------------------------------------------------

En los siguientes subapartados iremos presentado las funciones que se han desarrollado para hacer la abstracción a nivel \textit{software} de nuestros sensores y actuadores. En primer lugar presentamos las funciones que son comunes al propio sistema, debido a que engloban varios dispositivos del mismo. Estas son:

\begin{itemize}
\item \verb@InitSensors@. Su misión es la de preparar los periféricos dentro del \ac{MCU}, de forma que se habiliten los necesarios y en los pines correctos.
\item \verb@IntTmp@. Rutina de atención a la interrupción causada por el temporizador interno TMR5, necesaria tanto para definir tiempos de espera como señales moduladas.
\item \verb@IntCN@. Rutina de atención a la interrupción motivada por el cambio en alguna señal rutada hacia un \ac{CN}, tomando las acciones necesarias.
\end{itemize}

%-------------------------------------------------------------------
\subsection{Sensores}
%-------------------------------------------------------------------
\label{software:sec:sensores}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{Temperatura}
%-------------------------------------------------------------------
\label{software:sec:temp}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{Acelerómetro}
%-------------------------------------------------------------------
\label{software:sec:acc}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{Presencia}
%-------------------------------------------------------------------
\label{software:sec:pir}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{Luminosidad}
%-------------------------------------------------------------------
\label{software:sec:temp}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{Actuadores}
%-------------------------------------------------------------------
\label{software:sec:actuadores}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{Emisor infrarrojo}
%-------------------------------------------------------------------
\label{software:sec:ir}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{Buzzer}
%-------------------------------------------------------------------
\label{software:sec:buzz}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsubsection{LEDs}
%-------------------------------------------------------------------
\label{software:sec:leds}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\section{Demostración}
%-------------------------------------------------------------------
\label{software:sec:demo}
%-------------------------------------------------------------------
\todo{Escribir...}

%-------------------------------------------------------------------
\section{Herramientas}
%-------------------------------------------------------------------
\label{software:sec:herramientas}
%-------------------------------------------------------------------

Al igual que en casos anteriores, presentamos las herramientas utilizadas para la realización del \textit{software} de tanto la \ac{HAL} como de la demo.

%-------------------------------------------------------------------
\subsection{MPLAB X}
%-------------------------------------------------------------------
\label{software:sub:mplabx}
%-------------------------------------------------------------------

MPLAB X es la \ac{IDE} desarrollada por Microchip para la programación de sus microcontroladores. Está basado en el NetBeans \ac{IDE}, \textit{open-source} de Oracle, e incluye integrado el compilador de C para sus dispositivos. Entre algunas de las opciones que ofrece destacamos:

\begin{itemize}
\item Varias herramientas de depuración.
\item \textit{Parsing} y control de sintaxis en tiempo real.
\item Hipervínculos que permiten una navegación rápida para acceder a las declaraciones.
\end{itemize}

Más información puede ser consultada en el manual \cite{mplabx}.

%-------------------------------------------------------------------
\subsection{Programador: ICD 3}
%-------------------------------------------------------------------
\label{software:sub:icd3}
%-------------------------------------------------------------------

El \ac{ICD} es el dispositivo que permite programar el microcontrolador. En nuestro caso usaremos el \ac{ICD} 3 \cite{icd3}, el cual ha sido desarrollado para los productos de Microchip. Como característica adicional, ester dispositivo puede ser usado, en combinación con el MPLAB, para la depuración en tiempo real del \textit{software} corriendo en el \ac{MCU}, permitiendo hasta 6 puntos de parada. Este hecho resultará crucial en los siguientes apartados.


%
% Variable local para emacs, para  que encuentre el fichero maestro de
% compilación y funcionen mejor algunas teclas rápidas de AucTeX
%%%
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../Tesis.tex"
%%% End:
