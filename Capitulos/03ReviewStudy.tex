%---------------------------------------------------------------------
%
%                          Capítulo 3
%
%---------------------------------------------------------------------

\chapter{Estudio Previo}
\label{cap:previo}

\begin{FraseCelebre}
\begin{Frase}
El hombre no se mide por lo que conoce, \\
sino en cómo aplica lo que conoce
\end{Frase}
\begin{Fuente}
Anónimo
\end{Fuente}
\end{FraseCelebre}

\begin{resumen}
En este capítulo encontramos una primera aproximación de las necesidades que requiere la Placa de Expansión, en cuanto a módulos y funcionalidades se refiere. Asimismo, se presentarán, para cada uno de ellos, una justificación de su uso, los puntos más destacables y una tabla comparativa de los modelos que solucionan el problema.
\end{resumen}

%-------------------------------------------------------------------
\section{cNGD: Cognitive Next Generation Device}
%-------------------------------------------------------------------
\label{previo:sec:cngd}
%-------------------------------------------------------------------
Como vimos en el apartado \ref{intro:sec:antecedentes}, la placa de expansión se realizará para su anexión a la plataforma \ac{CNGD} \cite{aguspfc}, por lo que hacemos una breve introducción a ella. La figura \ref{previo:fig:cngd} muestra detalladamente dicha plataforma.

\begin{figure}[!h]
\centering 
\subfloat[Vista superior.]{\includegraphics[width=\textwidth]{Imagenes/Bitmap/Capitulo3/cngdtop}}  
\qquad
\subfloat[Vista infertior.]{\includegraphics[width=0.8\textwidth]{Imagenes/Bitmap/Capitulo3/cngdbottom}}     
\caption{Vista detallada del cNGD, obtenidas de \cite{aguspfc}.}
\label{previo:fig:cngd}
\end{figure}

El \ac{CNGD} incluye un Microchip \ac{PIC} de 32 bits modelo PIC32MX675F256L \cite{pic32datasheet}, el cual es un microntrolador de 100 pines en el que se incluyen una memoria Flash de 256 KB y 64 KB de memoria \ac{RAM}, una velocidad máxima de 80 MHz, módulos para comunicación serie \ac{UART}, \ac{SPI} e \ac{I2C}; \ac{USB} 2.0 \ac{OTG}, 10/100 Ethernet MAC, interfaz para la programación y la depuración, temporizadores digitales, \ac{ADC} y \ac{GPIO}. Adicionalmente, y si los requerimientos de la aplicación lo exigieran, se podría sustituir por el modelo PIC32MX675F512L, el cual tiene todos sus pines compatibles con el anterior y amplía la memoria Flash a 512 KB.

En cuanto a las \ac{RI}, se incluyen tres transceptores, por lo que es posible acceder a tres bandas del espectro: 434 MHz, 868 MHz y 2.4 GHz, todas ellas pertenecientes a la banda sin licencia, denominadas \ac{ISM}. Esto es relevante, puesto que, al ser bandas de acceso libre, pueden estar ocupadas por otras aplicaciones. El \ac{CNGD}, por medio de su capacidad cognitiva, es capaz de sensar el espectro en estas bandas y decidir dinámicamente cuál usar.

Las dos primeras (434 y 868 MHz) fueron diseñadas para esta plataforma a partir del integrado MRF49XA \cite{mrf49xa}, y tienen como principales características 115.2 Kbps de tasa máxima, consumos típicos de transmisión y recepción de 24 mA y 12 mA, respectivamente; y modulación \ac{FSK} con \ac{FHSS}. Para la comunicación en 2.4 GHz, se emplea el MRF24J40MA \cite{mrf24j40}, el cual nos permite hasta 120 metros de alcance, velocidad de transmisión de hasta 250 Kbps y consumos de transmisión y recepción de 23 mA y 19 mA respectivamente.

Una de las principales ventajas de este diseño es la cabecera de expansión, la cual permite ampliar el diseño de forma modular y totalmente escalable. Será en la misma donde introduciremos nuestra placa, por lo que le hacemos un estudio más exhaustivo. Se compone de 20 pines, cada uno multiplexado con diversas funciones, en el que se permite el acceso a los periféricos del microcontrolador. En la tabla \ref{previo:tab:headerspinout} encontramos una relación entre el pin del header, el pin del microcontrolador y las funciones que puede realizar.

\begin{center}
{\footnotesize
\begin{longtable}{l l l l l l l}

% aquí añadimos el encabezado de la primera hoja.
\hline
PIN & MCU PIN & 1a Func. & 2a Func. & 3a Func. & 4a Func. & 5a Func. \\
\hline \hline
\endfirsthead

% aquí añadimos el encabezado del resto de hojas.
\hline
PIN & MCU PIN & 1a Func. & 2a Func. & 3a Func. & 4a Func. & 5a Func. \\
\hline \hline
\endhead

% aquí añadimos el fondo de todas las hojas, excepto de la última.
\multicolumn{5}{c}{Continúa en la siguiente página.}
\endfoot

% aquí añadimos el fondo de la última hoja.
\endlastfoot

% aquí añadimos el cuerpo de la tabla.
00 & 19 & INT2 & RE9 & - & - & - \\ \hline
01 & 20 & VBUSON & AN5 & C1IN+ & CN7 & RB5\\ \hline
02 & 22 & AN3 & CN4 & RB3 & - & -\\ \hline
03 & 35 & AN11 & ERXERR & RB11 & - & - \\ \hline
04 & 41 & AN12 & ERXD0 & RB12 & - & - \\ \hline
05 & 42 & AN13 & ERXD1 & RB13 & - & - \\ \hline
06 & 51 & USBID & RF3 & - & - & - \\ \hline
07 & 54 & VBUS & - & - & - & - \\ \hline
08 & 13 & nMCLR & - & - & - & - \\ \hline
09 & 68 & EMDIO & IC1 & RD8 & - & - \\ \hline
10 & 59 & SDA2 & RA3 & - & - & - \\ \hline
11 & 58 & SCL2 & RA2 & - & - & - \\ \hline
12 & 57 & D+ & RG2 & - & - & - \\ \hline
13 & 56 & D- & RG3 & - & - & - \\ \hline
14 & - & VCC & - & - & - & - \\ \hline
15 & - & GND & - & - & - & - \\ \hline
16 & 44 & AN15 & CN12 & RB15 & - & -\\ \hline
17 & 43 & AN14 & RB14 & - & - & - \\ \hline
18 & 28 & VREF- & CVREF- & RA9 & - & - \\ \hline
19 & 29 & VREF+ & CVREF+ & RA10 & - & - \\ \hline
20 & 14 & REFCLK & U3nCTS & U6RX & CN11 & RG9 \\ \hline
21 & 11 & SDA4 & SDI2 & U3RX & CN9 & RG7 \\ \hline
22 & 5 & RE7 & - & - & - & -\\ \hline
23 & 3 & RE5 & - & - & - & -\\ \hline
24 & - & VCC & - & - & - & -\\ \hline
25 & 88 & ETXD0 & RF1 & - & - & -\\ \hline
26 & 87 & ETXD1 & RF0 & - & - & -\\ \hline
27 & 71 & EMDC & IC4 & RD11 & -& - \\ \hline
28 & - & VCC & - & - & - & -\\ \hline
29 & - & BAT+ & - & - & - & -\\ \hline
30 & - & BAT- & - & - & - & - \\ \hline
31 & - & GND & - & - & - & -\\ \hline
32 & 69 & IC2 & RD9 & - & - & - \\ \hline
33 & 83 & ETXEN & CN15 & RD6 & - & -\\ \hline
34 & - & GND & - & - & - & - \\ \hline
35 & 4 & RE6 & - & - & - & - \\ \hline
36 & 6 & RC1 & - & - & - & - \\ \hline
37 & 10 & SCK2 & U6TX & U3nRTS &CN8 & RG6\\ \hline
38 & 12 & ECRSDV & SCL4 & SDO2 & U3TX & CN10/RG8 \\ \hline
39 & 21 & AN4 & C1IN- & CN6 & RB4 & - \\ \hline
\\ % esta línea es importante para que deje un espacio entre la tabla y el nombre de la tabla.
\caption{Descripción del uso de los pines, obtenido de \cite{aguspfc}.}
\label{previo:tab:headerspinout}
\end{longtable}}
\end{center}

Resaltamos las más relevantes para nuestro diseño:

\begin{itemize}

\item \emph{Fuentes de alimentación}. Para la alimentación de los componentes, son necesarios estos pines.

	\begin{itemize}
	\item VCC. Conectado al sistema de alimentación del \ac{CNGD}, accesible desde los pines 14, 24 y 28.
	\item GND. Conectado a la masa del \ac{CNGD}, accesible desde los pines 15, 31 y 34.
	\end{itemize}

\item \emph{\ac{SPI}}. Para la conexión serie de dispositivos por medio de este estándar. Las tres señales que necesita, SDI, SDO y SCK son accesibles desde los pines 21, 38 y 37, respectivamente.

\item \emph{\ac{I2C}}. Para la conexión serie de dispositivos por medio de este estándar. Encontramos disponibles dos canales del microcontrolador:

	\begin{itemize}
	\item \ac{I2C} 2. SCL en el pin 38 y SDA en el pin 21.
	\item \ac{I2C} 4. SCL en el pin 11 y SDA en el pin 10.
	\end{itemize}

\item \emph{\ac{ADC}}. Son accesibles desde los pines nueve de los 16 \ac{ADC} del microcontrolador, referenciados en la tabla \ref{previo:tab:headerspinout} con el prefijo ANx. Adicionalmente, los pines VREF+ y VREF-, situados en el 19 y 18, proporcionan funciones auxiliares a este periférico.

\item \emph{\ac{GPIO}}. Representan casi todos los pines del header, multiplexados en su mayoría con otra función. Son identificados en la tabla \ref{previo:tab:headerspinout} mediante el uso del prefijo Rxx.

\end{itemize}

Finalmente, el \ac{CNGD} dispone de un módulo de programación, denominado PGE. Este será de utilidad a la hora de programar el microcontrolador, por medio de su interfaz, del software que se desarrolle para el control de la placa de expansión, y permitiendo la depuración In-Circuit del mismo usando las herramientas de Microchip.

%-------------------------------------------------------------------
\section{Sensores}
%-------------------------------------------------------------------
\label{previo:sec:sensores}
%-------------------------------------------------------------------
Los sensores van a ser la entrada de información a nuestro sistema, ya que por medio de sus mediciones conoceremos los parámetros del entorno, para poder actuar sobre él. Es por ello que debemos escogerlos adecuadamente, siguiendo el procedimiento que detallamos a continuación:

\begin{enumerate}

\item \emph{Definir los parámetros y valorarlos}. En esta fase seleccionamos los parámetros más destacables que nuestro sensor debe cumplir, y un margen de tolerancia para los mismos. Además, como restricción adicional, tendremos que cumplir los requisitos impuestos por la plataforma expuestos en \ref{previo:sec:cngd} y con el menor precio posible.
\item \emph{Buscar sensores comerciales}. Tomando como base los resultados de la fase anterior, y usando las páginas webs de los principales proveedores (como Farnell \cite{farnell}, RS \cite{rs} o Digikey \cite{digikey}), buscamos sensores que se adecúen.
\item \emph{Evaluar las \ac{DS}}. Las \ac{DS} son las hojas de características que proporcionan los fabricantes en las que se detallan todas las propiedades que conciernen a su producto. De esta evaluación obtenemos la verificación de que cumplen las constantes definidas.

\end{enumerate}

La gama comercial de clases de sensores es muy amplia, por lo que centraremos nuestra búsqueda en base a la aplicación. Como nuestro propósito es el de crear una placa con un propósito genérico dentro de un \ac{AMI}, escogeremos los sensores que consideramos más polivalentes para la mayoría de aplicaciones. Se presentan a continuación.

%-------------------------------------------------------------------
\subsection{Temperatura}
%-------------------------------------------------------------------
\label{previo:sec:temperatura}
%-------------------------------------------------------------------
Un sensor de temperatura es basado en la variación con la temperatura de alguno de los materiales que lo conforman, y ofrecen este dato como resultado. Según \cite{iele}, los sensores de temperatura se pueden clasificar en:

\begin{itemize}
\item \emph{Metálicos resistivos}, en los que la dependencia con la temperatura viene relacionada por la presencia de un elemento metálico, como puede ser el platino, el cobre o el níquel; y la variación de la temperatura se transforma en una variación en su resistencia eléctrica.
\item \emph{Resistivos semiconductores}, conocidos como termistores, presentan en su seno materiales semicondictures. Encontramos dos subtipos, el \ac{NTC}, formados a partir de óxidos de materiales pesados; y el \ac{PTC}, que incluye materiales como el $BaTiO_3$ o el $SrTiO_3$.
\item \emph{Semiconductores activos}, basados en la relación de la tensión base-emisor de un transisitor con la temperatura.
\item \emph{Termopares}, basados en efectos termoeléctricos, como pueden ser el de Seebeck, el de Peltier y el de Thompson.
\end{itemize}

Un sensor que nos permita conocer la temperatura es muy habitual encontrarlo en \ac{SN}, ya que es un parámetro que es útil en todas las aplicaciones potenciales del sistema, ya sea conocer la temperatura de una estancia, con el objeto de actuar sobre ella, si nos encontramos en un entorno doméstico o de trabajo; o de conocer la temperatura del suelo, con el objeto de monitorizar su variación con el tiempo, si es usado en temas de investigación medioambiental.

Los principales parámetros que los definen son:

\begin{itemize}

\item \emph{Rango de medida}. Define las temperaturas máximas y mínimas en las que se puede medir. Normalmente va asociado con el margen de funcionamiento del mismo, de forma que si trabajamos fuera de este margen el dispositivo se deteriorará. \newline
En nuestra aplicación, puede ser tam amplio como se pueda, pero fijando como mínimo un rango de medida entre -20 ºC y 100 ºC.
\item \emph{Precisión}. Es una forma de expresar la calidad de la medida, entendiendo ésta como la fiabilidad entre el dato medido y el dato real. En ocasiones también aparece nombrado como \emph{error}. Como es fácil de entender, es un parámetro que varía mucho el precio del mismo.\newline
Puesto que lo usaremos en una aplicación genérica, debemos encontrar un compromiso entre precio y precisión, por lo que centraremos nuestra búsqueda en valores de entre $\pm$0.2 ºC y $\pm$2 ºC.
\item \emph{Salida}. La podemos clasificar en dos tipos: 
	\begin{itemize}
	\item Analógica, en el cual la tensión de salida sigue una relación matemática del tipo $v_{temp}[V] = f(t)[ºC]$, y requiere, por tanto, del empleo de un \ac{ADC} para su inclusión en el microcontrolador.
	\item Digital, en el cual la temperatura se representa por una palabra binaria, y que se conecta al microcontrolador, generalmente, por buses serie, como pueden ser \ac{SPI} o \ac{I2C}.
	\end{itemize}
No imponemos ningún filtro a priori, puesto que el \ac{CNGD} dispone de entradas tanto digitales como analógicas. No obstante, es un dato que se debe conocer.
\end{itemize}

Los sensores de temperatura comerciales suelen ser, en su mayoría, termistores, a los que se les añade un circuito de acondicionamiento, de forma que en la salida únicamente encontramos variaciones en tensión o, directamente, una secuencia de `1' y `0', como hemos visto en sus características. Los que han sido evaluados, siguiendo estos requisitos, aparecen resumidos en la Tabla \ref{previo:tab:temp}

\begin{savenotes}
\begin{table}[h]
\centering
\scalebox{1}{
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
Nombre & Rango de Medida & Precisión\footnote{Típica en el margen que incluye a 25 ºC.} & Salida & Consumo & Precio & \ac{DS} \\ \hline \hline
TMP36 & [-40 ºC, 125 ºC] & $\pm$1 ºC & Analógica & 50 $\mu$A & 1.61 \euro & \cite{tmp36} \\ \hline
MCP9701A & [-40 ºC, 125 ºC] & $\pm$2 ºC & Analógica & 12 $\mu$A & 0.24 \euro & \cite{mcp9701} \\ \hline
LM20B & [-55 ºC, 130 ºC] & $\pm$2 ºC & Analógica & 10 $\mu$A & 1.07 \euro & \cite{lm20} \\ \hline
TMP101 & [-55 ºC, 125 ºC] & $\pm$2 ºC & Digital & 70 $\mu$A & 2.56 \euro & \cite{tmp101} \\ \hline
AD7814 & [-55 ºC, 125 ºC] & $\pm$2 ºC & Digital & 250 $\mu$A & 2.71 \euro & \cite{ad7814} \\ \hline
MCP9800 & [-55 ºC, 125 ºC] & $\pm$0.5 ºC & Digital & 200 $\mu$A & 0.98 \euro & \cite{mcp9701} \\ \hline
\end{tabular}
}
\caption{Comparación de sensores de temperatura comerciales.
\label{previo:tab:temp}}
\end{table}
\end{savenotes}


%-------------------------------------------------------------------
\subsection{Acelerómetro}
%-------------------------------------------------------------------
\label{previo:sec:acelerometro}
%-------------------------------------------------------------------
Definimos un acelerómetro como un sensor que nos permite medir aceleraciones, generalmente las asociadas con el fenómeno de peso experimentado por una masa de prueba que se encuentra en el mismo. Podemos encontrar varios tipos, a saber:

\begin{itemize}
\item \emph{Mecánico}. Basado en la Segunda Ley de Newton, se fabrica mediante la unión de la masa de prueba a un dinamómetro cuyo eje se encuentra en la dirección en la que se quiere medir.
\item \emph{Piezoeléctrico}. Tiene su fundamento físico en el hecho que, cuando se comprime un cristal con propiedades piezoeléctricas, se crea una carga eléctrica que es directamente proporcional a la fuerza que se aplica, la cual a su vez es proporcional a la aceleración.
\item \emph{Efecto Hall}. Se usa una masa sísmica, de forma que, al combinarla con un imán y un sensor de efecto Hall podemos detectar cambios en el campo magnético producidos por la variación de la masa sometida a una aceleración.
\item \emph{Condensador}. Se mide el cambio de la capacidad eléctrica de un condensador, al que se le ha añadido una masa sísmica entre sus placas, de forma que al moverse debido a una aceleración se modifica la corriente que circula por el condensador.
\item \emph{Tecnología \ac{MEMS}}. Están basados en el traspaso por convección de calor, cuya variación es causada por la aceleración.
\end{itemize}

A priori, puede parecer que introducir un sensor de este tipo es extraño para la obtención de parámetros de un entorno. No obstante, el uso de este tipo de sensores está creciendo con multitud de aplicaciones, por la versatilidad que le caracteriza. Tanto es así que puede ser usado, por ejemplo, para detectar la posición de la placa en el plano tridimensional, o para detectar vibraciones, bien generadas por la acción humana (como pisadas en el suelo o vehículos pasando por un puente) o por la naturaleza (como los terremotos).

Las principales características que los definen se resumen a continuación:

\begin{itemize}
\item \emph{Fondo de escala}. Es la máxima aceleración que se puede detectar. Viene referenciada como una proporción de la aceleración provocada por la gravedad terrestre, de forma que un valor de 2g implica una medida máxima de aceleración de 2 veces la gravedad. Como consecuencia de estar desarrollando una placa para una aplicación genérica, pondremos como requisito que sea capaz de detectar, al menos, una aceleración de 8g.
\item \emph{Sensibilidad}. Se define como el impacto que genera una variación de la temperatura a la salida, de forma que un valor alto implica que una leve variación de la temperatura ocasiona una gran variación a la salida. En los acelerómetros, este parámetro es dual al fondo de escala, de forma que cuanto más bajo sea el fondo de escala más alta será la sensibilidad.
\item \emph{Ejes de medida}. Número de ejes en los que se podrán detectar las variaciones en la aceleración. Estos se corresponden con los ejes de coordenadas: $\hat{x}$, $\hat{y}$ y $\hat{z}$.\newline En este aspecto, no admitiremos considerar acelerómetros que no midan en los tres ejes, ya que entendemos que no podemos despreciar ninguno.
\end{itemize}

En la actualidad, los acelerómetros comerciales que se encuentran a nivel de electrónica de consumo están basados en tecnología \ac{MEMS}, construidos e integrados en un chip de silicio, y que permiten fabricar acelerómetros de tres ejes. La tabla \ref{previo:tab:acc} muestra los acelerómetros comerciales que han sido estudiados.

\begin{savenotes}
\begin{table}[h]
\centering
\scalebox{1}{
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
Nombre & Fondo de escala & Ejes de medida & Salida & Consumo & Precio & \ac{DS} \\ \hline \hline
MMA8453Q & 2g, 4g, 8g & $\hat{x}$, $\hat{y}$, $\hat{z}$ & Digital & 50 $\mu$A & 1.61 \euro & \cite{tmp36} \\ \hline
ADXL345 & 2g, 4g, 8g, 16 & $\hat{x}$, $\hat{y}$, $\hat{z}$ & Digital & 12 $\mu$A & 0.24 \euro & \cite{mcp9701} \\ \hline
LIS3DH & 2g, 4g, 8g & $\hat{x}$, $\hat{y}$, $\hat{z}$ & Digital & 10 $\mu$A & 1.07 \euro & \cite{lm20} \\ \hline
\end{tabular}
}
\caption{Comparación de acelerómetros comerciales.
\label{previo:tab:acc}}
\end{table}
\end{savenotes}


%-------------------------------------------------------------------
\subsection{Presencia}
%-------------------------------------------------------------------
\label{previo:sec:presencia}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{Luminosidad}
%-------------------------------------------------------------------
\label{previo:sec:luminosidad}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\section{Actuadores}
%-------------------------------------------------------------------
\label{previo:sec:actuadores}
%--------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{Emisor Infrarrojo}
%-------------------------------------------------------------------
\label{previo:sec:ir}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{LEDs}
%-------------------------------------------------------------------
\label{previo:sec:leds}
%-------------------------------------------------------------------

Los \ac{LED} que actúan...

%-------------------------------------------------------------------
\subsection{GPIOs}
%-------------------------------------------------------------------
\label{previo:sec:gpio}
%-------------------------------------------------------------------

Podemos encontrar diversos \ac{GPIO} como ...

\todo{Escribir...}

%-------------------------------------------------------------------
%\section*{\NotasBibliograficas}
%-------------------------------------------------------------------
%\TocNotasBibliograficas
%Citamos algo para que aparezca en la bibliografía\ldots
%\citep{ldesc2e}

%\medskip

%Y también ponemos el acrónimo \ac{CVS} para que no cruja.

%Ten en cuenta que si no quieres acrónimos (o no quieres que te falle la compilación en ``release'' mientras no tengas ninguno) basta con que no definas la constante \verb+\acronimosEnRelease+ (en \texttt{config.tex}).


%-------------------------------------------------------------------
%\section*{\ProximoCapitulo}
%-------------------------------------------------------------------
%\TocProximoCapitulo

%...

% Variable local para emacs, para  que encuentre el fichero maestro de
% compilación y funcionen mejor algunas teclas rápidas de AucTeX
%%%
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../Tesis.tex"
%%% End:
