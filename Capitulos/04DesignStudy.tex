%---------------------------------------------------------------------
%
%                          Capítulo 4
%
%---------------------------------------------------------------------

\chapter{Estudio del Diseño y de la Implementación}
\label{cap:diseno}

\begin{FraseCelebre}
\begin{Frase}
El conocimiento, si no se sabe aplicar,\\
es peor que la ignorancia.
\end{Frase}
\begin{Fuente}
Charles Bukowski
\end{Fuente}
\end{FraseCelebre}

\begin{resumen}
In this chapter, the platform design is described. The design decisions, specifications, schemes and needed calculations will be exposed.
The detailed characteristics of any chosen component, (including microcontroller, radio interfaces, and power-supply options) will be provided.
\end{resumen}


%-------------------------------------------------------------------
\section{Sensores}
%-------------------------------------------------------------------
\label{diseno:sec:sensores}
%-------------------------------------------------------------------

En este apartado, se decidirán finalmente los sensores comerciales de los cuatro tipos expuestos en la sección \ref{previo:sec:sensores} que se incluirán y la forma en la que se colocarán, así como de la circuitería adicional que necesitan para funcionar. La estructura que se seguirá en los siguientes apartados se presenta a continuación.

\begin{enumerate}

\item Partiendo de lo expuesto en el capítulo \ref{cap:previo} procederemos, de manera justificada, a la elección del sensor comercial que se ajuste mejor a las necesidades del problema a resolver.
\item Se presentará un diagrama de bloques que ilustre el modo de operación interno del sensor, así como un diagrama de pines y las señales de entrada y salida del mismo.
\item Finalmente, se detallarán y se justificarán los componentes adicionales que se han de incluir al mismo.

\end{enumerate}

%-------------------------------------------------------------------
\subsection{Temperatura}
%-------------------------------------------------------------------
\label{diseno:sec:temperatura}
%-------------------------------------------------------------------

De los modelos presentados en la tabla \ref{previo:tab:temp}, decidimos escoger el \textbf{Microchip MCP9800} \cite{mcp9800}, principalmente por ser el de mayor precisión con un precio asequible. Sus características detalladas se exponen a continuación.

\begin{multicols}{2}
\begin{itemize}
\item Precisión típica de $\pm$0.5ºC a 25ºC.
\item Error máximo de $\pm$1ºC entre -10ºC y 85ºC.
\item Resolución seleccionable de 9-12 bits.
\item Conexión I$^2$C.
\item Corriente de operación típica de 200 $\mu$A.
\item Corriente de apagado máxima de 1 $\mu$A.
\item Salida independiente configurable (ALERTA).
\end{itemize}
\end{multicols}

La figura \ref{diseno:fig:temp} muestra las entradas y salidas del sensor por medio de su diagrama de pines, así como el circuito que precisa para funcionar. 

\figuraEx{Bitmap/Capitulo4/temp}{width=.5\textwidth}{diseno:fig:temp}%
{Sensor de Temperatura Microchip MCP9800.}{Sensor de Temperatura Microchip MCP9800.}

Comentamos brevemente la adición de los componentes añadidos. En la etapa de entrada encontramos R12 y C5, cuya función es de actuar a modo de filtro paso bajo ante el posible ruido procedente de la alimentación. R11 es una resistencia de \textit{pull-up}, necesaria ya que la salida es de colector abierto. Además de esta resistencia, y con este mismo propósito, se incluyen dos resistencias R1 y R2 de \textit{pull-up} para la conexión por I$^2$C.



%-------------------------------------------------------------------
\subsection{Acelerómetro}
%-------------------------------------------------------------------
\label{diseno:sec:acelerometro}
%-------------------------------------------------------------------

En base al análisis realizado en la sección \ref{previo:sec:acelerometro}, en el que se presentaban los distintos sensores comerciales estudiados, seleccionamos el \textbf{Freescale MMA8453Q} \cite{mma8453q} por ser el más económico que cumple las especificaciones. A continuación detallamos todas sus características:

\begin{itemize}
\item Fondos de escala seleccionables $\pm$2g, $\pm$4g y $\pm$8g.
\item Resolución seleccionable de 8-10 bits.
\item Conexión I$^2$C.
\item Modos de bajo consumo.
\item Consumo de corriente de entre 6$\mu$A y 165$\mu$A.
\item Dos salidas programables para seis fuentes de interrupción.
	\begin{multicols}{2}
	\begin{itemize}
	\item Dato disponible.
	\item Pulso (\textit{tap}).
	\item Movimiento.
	\item Caída libre.
	\item Orientación.
	\item \textit{Auto-SLEEP}.
	\end{itemize}
	\end{multicols}
\end{itemize}

A continuación encontramos, en la figura \ref{diseno:fig:acc}, el diagrama de pines junto con el circuito requerido para su operación

\figuraEx{Bitmap/Capitulo4/acc}{width=.5\textwidth}{diseno:fig:acc}%
{Acelerómetro Freescale MMA8453Q.}{Acelerómetro Freescale MMA8453Q.}

En primer lugar, resaltar que el pin 3 no se encuentra en la figura. Esto es así puesto que el fabricante nos indica que no debe ir conectado. Además, hemos conectado a masa el pin 7 (SA0), que hace que el bit menos significativo de la dirección para el I$^2$C sea 0.

Comentamos a continuación los componentes del circuito. C1 y C2 son condensadores de desacoplo para las dos entradas de alimentación (principal e interfaz), mientras que el condensador C3 es denominado de \textit{bypass}. Al igual que como hemos comentado en el sensor de temperatura, son necesarias dos resistencias de \textit{pull-up} para la interfaz I$^2$C y que no aparecen en este esquema.


%-------------------------------------------------------------------
\subsection{Presencia}
%-------------------------------------------------------------------
\label{diseno:sec:presencia}
%-------------------------------------------------------------------

Siguiendo la misma línea que con los sensores anteriores, y en base a lo expuesto en la tabla \ref{previo:tab:pir}, seleccionamos como sensor de presencia el \textbf{Panasonic AMN33112J} \cite{amn} por ser el que mejor verificó una relación fiabilidad-precio. Sus características son:

\begin{itemize}
\item Salida binaria.
\item Detección de personas en hasta 3 metros.
\item Detección de movimientos de 30 centímetros.
\item Modos de bajo consumo.
\item Consumo en espera de 170 $\mu$A.
\item Consumo en detección de 270 $\mu$A.
\end{itemize}

El diagrama de pines se presenta en la figura \ref{diseno:fig:pir}. Como podemos ver, no es necesario un circuito adicional, se puede conectar directamente al microcontrolador.

\figuraEx{Bitmap/Capitulo4/pir}{width=.5\textwidth}{diseno:fig:pir}%
{Sensor de Presencia Panasonic AMN33112J.}{Sensor de Presencia Panasonic AMN33112J.}


%-------------------------------------------------------------------
\subsection{Luminosidad}
%-------------------------------------------------------------------
\label{diseno:sec:presencia}
%-------------------------------------------------------------------

Para finalizar, exponemos y justificamos la elección del sensor de luminosidad. Se trata, de los estudiados en la sección \ref{previo:sec:luminosidad}, del \textbf{Avago APDS 9005} \cite{apds9005}, por su bajo precio y responsividad similar a la del ojo humano. Sus características ampliadas serían:

\begin{itemize}
\item Salida analógica.
\item Fotocorriente con 10 lux de 19$\mu$A.
\item Fotocorriente con 100 lux de 230$\mu$A.
\item Corriente de oscuridad de 50 nA.
\item Tensión de saturación de $2.32$ V.
\end{itemize}

El diagrama de entradas y salidas del sensor lo encontramos en la figura \ref{diseno:fig:lum}. AL igual que en casos anteriores, los pines 2-5 no figuran al indicarse que no deben ser conectados a ningún punto.

\figuraEx{Bitmap/Capitulo4/lum}{width=.5\textwidth}{diseno:fig:lum}%
{Sensor de Luminosidad Avago APDS 9005.}{Sensor de Luminosidad Avago APDS 9005.}

De los compontentes que encontramos a la salida del sensor, justificamos la presencia de la resistencia R3 con el objeto de convertir la fotocorriente a tensión, de forma que puede ser introducida al \ac{ADC}. El valor de 10 K$\Omega$ hace que la tensión con 10 luxes sea de 1.9 V. El condensador C4 se pone con motivo de filtrar el rizado producido por fuentes de iluminación fluorescentes.

%-------------------------------------------------------------------
\section{Actuadores}
%-------------------------------------------------------------------
\label{diseno:sec:actuadores}
%-------------------------------------------------------------------

De forma similar a como procedimos con los sensores presentamos los actuadores que formarán nuestro sistema, partiendo de los requisitos analizados en la sección \ref{previo:sec:actuadores}.

%-------------------------------------------------------------------
\subsection{Emisor Infrarrojo}
%-------------------------------------------------------------------
\label{diseno:sec:ir}
%-------------------------------------------------------------------

El \ac{IR} escogido fue el \textbf{Vishay TSUS5202} \cite{tsus}, el cual se caracteriza por los siguientes parámetros.

\begin{multicols}{2}
\begin{itemize}
\item Componente \ac{TH}.
\item Longitud de onda $\lambda_p=950$ nm.
\item Tiempo de respuesta $t_r=800$ ns.
\item Corriente máxima de 0.1 A.
\end{itemize}
\end{multicols}

De forma análoga a los casos anteriores, presentamos el circuito necesario correspondiente a este actuador en la figura \ref{diseno:fig:ir}.

\figuraEx{Bitmap/Capitulo4/ir}{width=.3\textwidth}{diseno:fig:ir}%
{Emisor Infrarrojo Vishay TSUS5202.}{Emisor Infrarrojo Vishay TSUS5202.}

El único componente que encontramos es una resistencia, cuya función es la de limitar la corriente que circula por el diodo, puesto que si excede de la máxima especificada el \ac{IR} podría dejar de funcionar. Para no disminuir la potencia de emisión, que es directamente proporcional a la corriente de excitación, impondremos que dicha corriente sea tan similar a la máxima como sea posible. La calculamos como:

$$R_8 \geq {\frac {3.3V-0.7V}{0.1A}}=26\Omega$$

Para asegurar, escogemos un valor de resistencia de $33\Omega$, de forma que se tendrá una corriente de 87 mA.


%-------------------------------------------------------------------
\subsection{Buzzer}
%-------------------------------------------------------------------
\label{diseno:sec:buzzer}
%-------------------------------------------------------------------

Para el zumbador elegimos el modelo comercial de \textbf{TDK PS1720} \cite{buzzer}, el cual fue diseñado para aplicaciones de alarma, como corresponde en nuestro caso, y que tiene un precio de 0.75 \euro. La figura \ref{diseno:fig:buzz} muestra el circuito pasa su correcto funcionamiento.

\figuraEx{Bitmap/Capitulo4/buzz}{width=.5\textwidth}{diseno:fig:buzz}%
{Buzzer TDK PS1720.}{Buzzer TDK PS1720.}

Podemos observar varios componentes en este diseño. En primer lugar remarcamos la presencia del transistor NPN Q1, cuya función es la de hacer de amplificador de corriente a la entrada del zumbador. Además, en paralelo con el buzzer se introduce la resistencia R9 con el propósito de realizar la carga y la descarga del elemento piezoeléctrico. Finalmente, la resistencia R10 se introduce con propósitos de seguridad.

%-------------------------------------------------------------------
\subsection{LEDs}
%-------------------------------------------------------------------
\label{diseno:sec:leds}
%-------------------------------------------------------------------

Con el objeto de poder hacer depuración en etapas siguientes del proceso, y como salida visual de diferentes parámetros, añadimos dos \ac{LED}, verde y rojo, al diseño de la placa. Su circuito, similar al visto en la sección \ref{diseno:sec:ir} se presenta en la figura \ref{diseno:fig:led}.

\figuraEx{Bitmap/Capitulo4/led}{width=.3\textwidth}{diseno:fig:led}%
{LED de información y depuración.}{LED de información y depuración.}

En este caso, los valores de las resistencias han aumentado con respecto a lo visto en el caso del \ac{LED} \ac{IR}, puesto que en este caso nos basta con que el mismo tenga un nivel de iluminación en el que se permita discernir si está encendido o apagado, por lo que no es necesaria tanta corriente. En este sentido, hemos considerado que un valor de 330$\Omega$ es suficiente.

%-------------------------------------------------------------------
\section{Esquemático}
%-------------------------------------------------------------------
\label{diseno:sec:esquematico}
%-------------------------------------------------------------------

SDFSDF

%-------------------------------------------------------------------
\section{Resultado final}
%-------------------------------------------------------------------
\label{diseno:sec:herramientas}
%-------------------------------------------------------------------

SADFQW 


%-------------------------------------------------------------------
\subsection{Implementación en PCB}
%-------------------------------------------------------------------

SDFS 


%-------------------------------------------------------------------
\subsection{Lista de Materiales}
%-------------------------------------------------------------------

SDFSDFS

%-------------------------------------------------------------------
\subsection{Layout}
%-------------------------------------------------------------------

ÑOUIOÑUI


%-------------------------------------------------------------------
\section{Herramientas}
%-------------------------------------------------------------------
\label{diseno:sec:herramientas}
%-------------------------------------------------------------------


UYKJRTFRU7JRFU


%-------------------------------------------------------------------
\subsection{Altium Designer}
%-------------------------------------------------------------------

SDJGKFAH U

%-------------------------------------------------------------------
\subsubsection{Librería de componentes}
%-------------------------------------------------------------------


%-------------------------------------------------------------------
\subsection{Puesto de Soldadura}
%-------------------------------------------------------------------

FGHDG 

